;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; PHP-FPM Pool Configuration for High-Concurrency Media Grid
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

[www]

; -----------------------------------
; General settings
; -----------------------------------
user = www-data
group = www-data
listen = /run/php-fpm/www.sock   ; Unix socket for maximum throughput
; listen = 127.0.0.1:9000        ; alternative TCP
listen.owner = www-data
listen.group = www-data
listen.mode = 0660

; -----------------------------------
; Process manager settings
; -----------------------------------
pm = dynamic
pm.max_children = 300            ; max simultaneous PHP processes
pm.start_servers = 40            ; initial ready processes
pm.min_spare_servers = 20        ; minimum idle
pm.max_spare_servers = 80        ; maximum idle
pm.max_requests = 1000           ; recycle after N requests to prevent leaks
pm.process_idle_timeout = 30s    ; kill idle processes

; -----------------------------------
; Performance tuning
; -----------------------------------
; Allow very high pending connections
listen.backlog = 65535

; Kill scripts running too long
request_terminate_timeout = 120s

; Limit memory usage (optional safety)
; php_admin_value[memory_limit] = 512M

; Allow many open files
rlimit_files = 65535

; -----------------------------------
; Logging
; -----------------------------------
catch_workers_output = yes
access.log = /var/log/php-fpm/www-access.log
slowlog = /var/log/php-fpm/www-slow.log
request_slowlog_timeout = 10s

; -----------------------------------
; Status page (optional)
; -----------------------------------
pm.status_path = /status